<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>enhanceclaude.com - AI Skills & Agents Registry</title>

<!-- Google Fonts: Space Grotesk for headings -->
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet" />

<!-- Material Symbols -->
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&display=swap" rel="stylesheet" />

<style>
/* ============================================================
   @layer base    — resets, custom properties, typography
   @layer layout  — page structure: header, sidebar, main, footer
   @layer components — cards, hero, dialog, badges, buttons
   @layer utilities  — helpers: .is-hidden, .sr-only
   ============================================================ */

@layer base, layout, components, utilities;

/* ---------- BASE ---------- */
@layer base {
  :root {
    --bg-page: #0f1117;
    --bg-surface: #161b22;
    --bg-surface-hover: #1f2633;
    --border: #30363d;
    --text-main: #e6edf3;
    --text-muted: #8b949e;
    --primary: #137fec;
    --primary-dark: #0b5cb5;
    --agent-accent: #60a5fa;
    --skill-accent: #facc15;
    --font-body: system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    --font-display: "Space Grotesk", var(--font-body);
    --font-title: "Inter", var(--font-body);
  }

  *, *::before, *::after {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }

  html {
    color-scheme: dark;
  }

  body {
    font-family: var(--font-body);
    background: var(--bg-page);
    color: var(--text-main);
    line-height: 1.6;
    min-height: 100dvh;
    display: flex;
    flex-direction: column;
    -webkit-font-smoothing: antialiased;
  }

  h1, h2, h3, h4, h5, h6 {
    font-family: var(--font-display);
    line-height: 1.2;
  }

  a {
    color: inherit;
    text-decoration: none;
  }

  button {
    cursor: pointer;
    font: inherit;
    border: none;
    background: none;
    color: inherit;
  }

  img {
    display: block;
    max-width: 100%;
  }

  ::selection {
    background: var(--primary);
    color: #fff;
  }

  /* Scrollbar */
  ::-webkit-scrollbar { width: 8px; height: 8px; }
  ::-webkit-scrollbar-track { background: var(--bg-page); }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }
  ::-webkit-scrollbar-thumb:hover { background: var(--text-muted); }
}

/* ---------- LAYOUT ---------- */
@layer layout {
  /* -- Header -- */
  .site-header {
    position: sticky;
    top: 0;
    z-index: 100;
    width: 100%;
    border-bottom: 1px solid var(--border);
    background: rgba(15, 17, 23, 0.85);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
  }

  .header-inner {
    max-width: 1280px;
    margin: 0 auto;
    padding: 0 1rem;
    height: 4rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
  }

  .logo-area {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    flex-shrink: 0;
  }

  .logo-icon {
    width: 2rem;
    height: 2rem;
    border-radius: 6px;
    background: rgba(19, 127, 236, 0.1);
    color: var(--primary);
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .logo-text {
    font-family: var(--font-display);
    font-size: 1.1rem;
    font-weight: 700;
    color: #fff;
    letter-spacing: -0.02em;
  }

  .logo-separator {
    width: 1px;
    height: 1.25rem;
    background: var(--border);
    display: none;
  }

  .logo-tagline {
    font-size: 0.7rem;
    color: var(--text-muted);
    font-weight: 500;
    white-space: nowrap;
    display: none;
    padding: 0.3rem 0.75rem;
    background: var(--bg-surface);
    border: 1px solid var(--border);
    border-radius: 999px;
    letter-spacing: 0.03em;
  }

  @media (min-width: 768px) {
    .logo-separator { display: inline-block; }
    .logo-tagline { display: inline-block; }
  }

  .search-wrapper {
    flex: 1;
    max-width: 36rem;
    margin: 0 1rem;
  }

  .search-field {
    position: relative;
  }

  .search-field .material-symbols-outlined {
    position: absolute;
    left: 0.75rem;
    top: 50%;
    transform: translateY(-50%);
    font-size: 20px;
    color: var(--text-muted);
    pointer-events: none;
    transition: color 0.2s;
  }

  .search-field input {
    width: 100%;
    padding: 0.5rem 1rem 0.5rem 2.5rem;
    border-radius: 8px;
    border: 1px solid var(--border);
    background: var(--bg-surface);
    color: #fff;
    font-size: 0.875rem;
    outline: none;
    transition: border-color 0.2s, box-shadow 0.2s;
  }

  .search-field input::placeholder { color: var(--text-muted); }
  .search-field input:focus { border-color: var(--primary); box-shadow: 0 0 0 1px var(--primary); }
  .search-field input:focus ~ .material-symbols-outlined { color: var(--primary); }

  .header-actions {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    flex-shrink: 0;
  }

  .header-actions a {
    padding: 0.5rem;
    border-radius: 6px;
    color: var(--text-muted);
    transition: color 0.2s, background 0.2s;
  }

  .header-actions a:hover {
    color: #fff;
    background: var(--border);
  }

  /* -- Page layout -- */
  .page-layout {
    flex: 1;
    max-width: 1280px;
    width: 100%;
    margin: 0 auto;
    padding: 2rem 1rem;
    display: flex;
    gap: 2rem;
  }

  /* -- Sidebar -- */
  .sidebar {
    width: 250px;
    flex-shrink: 0;
  }

  .sidebar-sticky {
    position: sticky;
    top: 5.5rem;
  }

  .sidebar-showing {
    font-size: 0.8rem;
    color: var(--text-muted);
    padding: 0 0.5rem;
    margin-bottom: 1.25rem;
    font-weight: 500;
  }

  .sidebar-heading {
    font-size: 0.75rem;
    font-weight: 700;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.08em;
    padding: 0 0.5rem;
    margin-bottom: 1rem;
  }

  .sidebar-nav {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
    list-style: none;
  }

  .sidebar-nav-btn {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    width: 100%;
    padding: 0.5rem 0.75rem;
    font-size: 0.875rem;
    font-weight: 500;
    border-radius: 6px;
    color: var(--text-muted);
    transition: color 0.2s, background 0.2s;
    text-align: left;
  }

  .sidebar-nav-btn:hover {
    background: var(--bg-surface-hover);
    color: #fff;
  }

  .sidebar-nav-btn.is-active {
    background: rgba(19, 127, 236, 0.1);
    color: var(--primary);
    border-left: 2px solid var(--primary);
  }

  .sidebar-nav-btn .material-symbols-outlined { font-size: 20px; }

  .sidebar-count {
    margin-left: auto;
    font-size: 0.75rem;
    color: var(--text-muted);
    background: var(--bg-surface);
    padding: 0.1rem 0.45rem;
    border-radius: 99px;
    font-weight: 600;
  }

  /* -- Tag filter panel (sidebar) -- */
  .tag-filter-panel {
    display: flex;
    flex-wrap: wrap;
    gap: 0.375rem;
    padding: 0 0.25rem;
    max-height: 200px;
    overflow-y: auto;
    scrollbar-width: thin;
  }

  .tag-filter-panel::-webkit-scrollbar { width: 4px; }
  .tag-filter-panel::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

  .tag-filter-chip {
    padding: 0.2rem 0.5rem;
    border-radius: 4px;
    font-size: 0.675rem;
    background: rgba(48, 54, 61, 0.3);
    color: var(--text-muted);
    border: 1px solid var(--border);
    cursor: pointer;
    transition: all 0.15s;
    white-space: nowrap;
  }

  .tag-filter-chip:hover {
    color: #fff;
    border-color: var(--text-muted);
  }

  .tag-filter-chip.is-active {
    background: rgba(19, 127, 236, 0.15);
    color: var(--primary);
    border-color: rgba(19, 127, 236, 0.4);
  }

  .tag-clear-btn {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    margin-top: 0.5rem;
    padding: 0.25rem 0.5rem;
    font-size: 0.7rem;
    color: var(--text-muted);
    border-radius: 4px;
    cursor: pointer;
    transition: color 0.15s;
  }
  .tag-clear-btn:hover { color: #fff; }

  /* -- Mobile sidebar -- */
  .mobile-filters {
    display: none;
    flex-direction: column;
    gap: 0.5rem;
    padding-bottom: 1rem;
  }

  .mobile-filters-row {
    display: flex;
    gap: 0.5rem;
    overflow-x: auto;
    scrollbar-width: none;
    align-items: center;
  }
  .mobile-filters-row::-webkit-scrollbar { display: none; }

  .mobile-filter-btn {
    white-space: nowrap;
    padding: 0.5rem 1rem;
    border-radius: 99px;
    font-size: 0.875rem;
    font-weight: 500;
    background: var(--bg-surface);
    border: 1px solid var(--border);
    color: var(--text-muted);
    transition: all 0.2s;
  }
  .mobile-filter-btn:hover { color: #fff; }
  .mobile-filter-btn.is-active {
    background: var(--primary);
    color: #fff;
    border-color: var(--primary);
  }

  /* -- Mobile tag toggle button -- */
  .mobile-tag-toggle {
    display: flex;
    align-items: center;
    gap: 0.35rem;
  }

  .mobile-tag-toggle.has-active {
    background: rgba(19, 127, 236, 0.15);
    color: var(--primary);
    border-color: rgba(19, 127, 236, 0.4);
  }

  /* -- Mobile tag panel (inline, pushes content down) -- */
  .mobile-tag-panel {
    display: flex;
    flex-wrap: wrap;
    gap: 0.375rem;
    padding: 0.5rem 0;
  }

  /* -- Main content area -- */
  .main-content {
    flex: 1;
    min-width: 0;
  }

  /* -- Footer -- */
  .site-footer {
    border-top: 1px solid var(--border);
    background: var(--bg-surface);
    margin-top: auto;
    padding: 2rem 1rem;
  }

  .footer-inner {
    max-width: 1280px;
    margin: 0 auto;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.75rem;
    text-align: center;
  }

  .footer-brand {
    font-size: 0.875rem;
    font-weight: 600;
    color: #fff;
  }

  .footer-contact {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.85rem;
    color: var(--text-muted);
    margin-bottom: 0.75rem;
  }

  .footer-email {
    color: var(--primary);
    text-decoration: none;
    font-weight: 500;
  }

  .footer-email:hover {
    text-decoration: underline;
  }

  .footer-disclaimer {
    font-size: 0.75rem;
    color: var(--text-muted);
    max-width: 40rem;
    line-height: 1.5;
  }

  /* Responsive: collapse sidebar on small screens */
  @media (max-width: 768px) {
    .sidebar { display: none; }
    .mobile-filters { display: flex; }
    .page-layout { flex-direction: column; padding-top: 1rem; }
    .logo-text { display: none; }
  }
}

/* ---------- COMPONENTS ---------- */
@layer components {
  /* -- Hero Banner -- */
  .hero {
    position: relative;
    overflow: hidden;
    border-radius: 12px;
    border: 1px solid var(--border);
    background: var(--bg-surface);
    margin-bottom: 2rem;
  }

  .hero-dots {
    position: absolute;
    inset: 0;
    opacity: 0.15;
    background-image: radial-gradient(var(--primary) 1px, transparent 1px);
    background-size: 16px 16px;
    pointer-events: none;
  }

  .hero-content {
    position: relative;
    padding: 2.5rem;
    max-width: 42rem;
  }

  .hero-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.25rem 0.75rem;
    border-radius: 99px;
    background: rgba(19, 127, 236, 0.1);
    border: 1px solid rgba(19, 127, 236, 0.2);
    font-size: 0.75rem;
    font-weight: 500;
    color: var(--primary);
    margin-bottom: 1rem;
  }

  .hero-badge-dot {
    position: relative;
    width: 0.5rem;
    height: 0.5rem;
  }

  .hero-badge-dot::before,
  .hero-badge-dot::after {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: 50%;
    background: var(--primary);
  }

  .hero-badge-dot::before {
    animation: ping 1.5s cubic-bezier(0, 0, 0.2, 1) infinite;
  }

  @keyframes ping {
    75%, 100% {
      transform: scale(2);
      opacity: 0;
    }
  }

  .hero h2 {
    font-size: clamp(1.75rem, 4vw, 2.5rem);
    font-weight: 700;
    color: #fff;
    letter-spacing: -0.02em;
    margin-bottom: 0.75rem;
  }

  .hero-gradient-text {
    background: linear-gradient(90deg, var(--primary), var(--agent-accent));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .hero p {
    font-size: 1.1rem;
    color: var(--text-muted);
    max-width: 36rem;
  }


  /* -- Tool Cards -- */
  .cards-container {
    display: flex;
    flex-direction: column;
    gap: 1.25rem;
  }

  .tool-card {
    border-radius: 8px;
    border: 1px solid var(--border);
    background: var(--bg-surface);
  }

  .card-inner {
    padding: 1.25rem 1.5rem;
  }

  .card-top {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 1rem;
    margin-bottom: 1rem;
  }

  .card-top-left {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
  }

  .card-icon {
    flex-shrink: 0;
    width: 3rem;
    height: 3rem;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 28px;
  }

  .card-icon--agent {
    background: rgba(96, 165, 250, 0.1);
    color: var(--agent-accent);
    border: 1px solid rgba(96, 165, 250, 0.2);
  }

  .card-icon--skill {
    background: rgba(250, 204, 21, 0.1);
    color: var(--skill-accent);
    border: 1px solid rgba(250, 204, 21, 0.2);
  }

  .card-name-row {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.25rem;
    flex-wrap: wrap;
  }

  .card-name {
    font-family: var(--font-title);
    font-size: 1.1rem;
    font-weight: 600;
    color: #fff;
    transition: color 0.2s;
    letter-spacing: -0.01em;
  }


  .card-version {
    padding: 0.125rem 0.5rem;
    border-radius: 4px;
    font-size: 0.625rem;
    font-family: monospace;
    font-weight: 500;
    background: var(--border);
    color: var(--text-muted);
    border: 1px solid var(--border);
  }

  .card-meta {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 0.75rem;
    font-size: 0.8125rem;
    color: var(--text-muted);
  }

  .card-type-label {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    font-weight: 500;
  }

  .card-type-label .material-symbols-outlined { font-size: 16px; }

  .card-type-label--agent { color: var(--agent-accent); }
  .card-type-label--skill { color: var(--skill-accent); }

  .meta-dot {
    width: 4px;
    height: 4px;
    border-radius: 50%;
    background: var(--border);
  }

  .card-description {
    background: rgba(15, 17, 23, 0.5);
    border: 1px solid rgba(48, 54, 61, 0.5);
    border-radius: 6px;
    padding: 1rem;
    font-size: 0.875rem;
    color: rgba(230, 237, 243, 0.85);
    line-height: 1.6;
    margin-bottom: 0.75rem;
  }

  .card-footer-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .card-tags {
    display: flex;
    gap: 0.375rem;
    flex-wrap: wrap;
  }

  .tag-badge {
    padding: 0.15rem 0.5rem;
    border-radius: 4px;
    font-size: 0.6875rem;
    background: rgba(48, 54, 61, 0.3);
    color: var(--text-muted);
    border: 1px solid var(--border);
  }

  .os-badges {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    font-size: 0.6875rem;
    color: var(--text-muted);
  }

  .os-badge {
    padding: 0.125rem 0.4rem;
    border-radius: 4px;
    background: rgba(48, 54, 61, 0.4);
    border: 1px solid var(--border);
    text-transform: capitalize;
  }

  .card-actions {
    display: flex;
    align-items: center;
    gap: 0.375rem;
    flex-shrink: 0;
  }

  /* Shared base for all 3 card action buttons */
  .card-action-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    height: 2rem;
    border-radius: 6px;
    font-size: 0.8125rem;
    font-weight: 500;
    border: 1px solid var(--border);
    color: var(--text-muted);
    background: none;
    transition: all 0.2s;
  }

  .card-action-btn .material-symbols-outlined { font-size: 16px; }

  .card-action-btn:hover {
    color: var(--primary);
    border-color: rgba(19, 127, 236, 0.3);
    background: rgba(19, 127, 236, 0.1);
  }

  /* Icon-only buttons (share, expand) */
  .card-share-btn,
  .card-expand-btn {
    width: 2rem;
  }

  .card-share-btn.is-copied {
    color: #22c55e;
    border-color: rgba(34, 197, 94, 0.3);
    background: rgba(34, 197, 94, 0.1);
  }

  .card-expand-btn .material-symbols-outlined {
    transition: transform 0.2s;
  }

  .tool-card.is-expanded .card-expand-btn .material-symbols-outlined {
    transform: rotate(180deg);
  }

  .tool-card.is-expanded .card-expand-btn {
    color: var(--primary);
    border-color: rgba(19, 127, 236, 0.3);
    background: rgba(19, 127, 236, 0.1);
  }

  /* Install button (icon + text) */
  .card-install-btn {
    gap: 0.375rem;
    padding: 0 0.75rem;
    color: var(--primary);
    border-color: rgba(19, 127, 236, 0.2);
    background: rgba(19, 127, 236, 0.1);
  }

  .card-install-btn:hover {
    background: rgba(19, 127, 236, 0.2);
  }

  .card-custom-note {
    margin-top: 0.5rem;
    display: flex;
    align-items: flex-start;
    gap: 0.375rem;
    font-size: 0.75rem;
    color: var(--text-muted);
    padding: 0.5rem 0.75rem;
    background: rgba(48, 54, 61, 0.15);
    border-radius: 4px;
    border-left: 2px solid var(--primary);
  }

  .card-custom-note .material-symbols-outlined { font-size: 14px; flex-shrink: 0; margin-top: 0.1rem; }

  /* -- Expanded Detail Panel -- */
  .tool-detail-panel {
    border-top: 1px solid var(--border);
    background: var(--bg-page);
    margin: 0.75rem -1.5rem -1.25rem;
    padding: 1.25rem 1.5rem;
    border-radius: 0 0 7px 7px;
    animation: detailFadeIn 0.2s ease;
  }

  @keyframes detailFadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  .tool-card.is-expanded {
    border-color: rgba(19, 127, 236, 0.3);
  }

  .detail-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding-bottom: 0.75rem;
    margin-bottom: 0.75rem;
    border-bottom: 1px solid var(--border);
  }

  .detail-title {
    font-family: var(--font-title);
    font-size: 0.95rem;
    font-weight: 600;
    color: #fff;
  }

  .detail-close-btn {
    padding: 0.35rem;
    border-radius: 6px;
    color: var(--text-muted);
    transition: color 0.2s, background 0.2s;
  }

  .detail-close-btn:hover { color: #fff; background: var(--border); }

  .detail-readme {
    font-size: 0.85rem;
    line-height: 1.7;
    color: rgba(230, 237, 243, 0.85);
  }

  .detail-readme h1 { font-size: 1.1rem; font-weight: 700; color: #fff; margin: 1rem 0 0.5rem; }
  .detail-readme h2 { font-size: 0.95rem; font-weight: 600; color: var(--primary); margin: 1rem 0 0.4rem; border-bottom: 1px solid var(--border); padding-bottom: 0.3rem; }
  .detail-readme p { margin-bottom: 0.6rem; }
  .detail-readme hr { border: none; border-top: 1px solid var(--border); margin: 1rem 0; }
  .detail-readme em { color: var(--text-muted); }
  .detail-readme strong { color: #fff; }
  .detail-readme a { color: var(--primary); text-decoration: underline; }
  .detail-readme code { font-family: monospace; font-size: 0.8rem; background: var(--bg-surface); padding: 0.15rem 0.4rem; border-radius: 4px; border: 1px solid var(--border); }
  .detail-readme ul, .detail-readme ol { margin: 0.4rem 0 0.6rem 1.25rem; }
  .detail-readme li { margin-bottom: 0.25rem; }


  /* -- Install Dialog -- */
  .install-dialog {
    border: 1px solid var(--border);
    border-radius: 12px;
    background: var(--bg-surface);
    color: var(--text-main);
    padding: 0;
    max-width: 900px;
    width: calc(100% - 2rem);
    box-shadow: 0 24px 48px rgba(0, 0, 0, 0.5);
    position: fixed;
    top: 50%;
    transform: translateY(-50%);
    margin: 0;
  }

  .install-dialog::backdrop {
    background: rgba(0, 0, 0, 0.65);
    backdrop-filter: blur(4px);
    -webkit-backdrop-filter: blur(4px);
  }

  .dialog-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1.25rem 1.5rem;
    border-bottom: 1px solid var(--border);
  }

  .dialog-title {
    font-family: var(--font-display);
    font-size: 1.1rem;
    font-weight: 700;
    color: #fff;
  }

  .dialog-close-btn {
    padding: 0.35rem;
    border-radius: 6px;
    color: var(--text-muted);
    transition: color 0.2s, background 0.2s;
  }
  .dialog-close-btn:hover { color: #fff; background: var(--border); }
  .dialog-close-btn .material-symbols-outlined { font-size: 20px; }

  .dialog-body {
    padding: 1.5rem;
    max-height: 70vh;
    overflow-y: auto;
  }

  .dialog-section {
    margin-bottom: 1.25rem;
  }

  .dialog-section:last-child { margin-bottom: 0; }

  .dialog-section-label {
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    color: var(--text-muted);
    margin-bottom: 0.5rem;
  }

  .dialog-meta-row {
    display: flex;
    gap: 0.75rem;
    flex-wrap: wrap;
  }

  .dialog-meta-item {
    display: flex;
    align-items: center;
    gap: 0.375rem;
    font-size: 0.8125rem;
    color: var(--text-main);
  }

  .dialog-meta-item .material-symbols-outlined { font-size: 16px; color: var(--text-muted); }

  .dialog-clone-block {
    background: rgba(15, 17, 23, 0.6);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 1rem;
    margin-bottom: 0.5rem;
  }

  .dialog-clone-label {
    font-size: 0.7rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--text-muted);
    margin-bottom: 0.375rem;
  }

  .dialog-clone-row {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .dialog-clone-row code {
    flex: 1;
    font-family: monospace;
    font-size: 0.8rem;
    padding: 0.4rem 0.625rem;
    background: var(--bg-page);
    border: 1px solid var(--border);
    border-radius: 6px;
    color: var(--text-main);
    overflow-x: auto;
    white-space: nowrap;
  }

  .copy-btn {
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 2rem;
    height: 2rem;
    border-radius: 6px;
    background: var(--border);
    color: var(--text-muted);
    transition: color 0.2s, background 0.2s;
  }

  .copy-btn:hover {
    background: var(--primary);
    color: #fff;
  }

  .copy-btn .material-symbols-outlined { font-size: 16px; }

  .copy-btn--copied {
    background: #22c55e;
    color: #fff;
  }

  .dialog-platform-block {
    background: rgba(15, 17, 23, 0.6);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 1rem;
    margin-bottom: 0.75rem;
  }

  .dialog-platform-name {
    font-weight: 600;
    color: #fff;
    margin-bottom: 0.5rem;
    font-size: 0.9rem;
  }

  .dialog-install-entry {
    margin-bottom: 0.75rem;
  }

  .dialog-install-entry:last-child { margin-bottom: 0; }

  .dialog-install-type {
    font-size: 0.75rem;
    font-weight: 600;
    color: var(--text-muted);
    text-transform: uppercase;
    margin-bottom: 0.25rem;
  }

  .dialog-install-scope {
    font-size: 0.6875rem;
    color: var(--text-muted);
    margin-bottom: 0.25rem;
  }

  .dialog-install-path {
    font-family: monospace;
    font-size: 0.8125rem;
    padding: 0.375rem 0.625rem;
    border-radius: 4px;
    background: rgba(48, 54, 61, 0.4);
    border: 1px solid var(--border);
    color: var(--text-main);
    word-break: break-all;
    display: block;
    margin-bottom: 0.25rem;
  }

  .dialog-install-path--windows {
    color: var(--text-muted);
    font-size: 0.75rem;
  }

  .dialog-custom-instructions {
    background: rgba(15, 17, 23, 0.6);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 1rem;
    font-size: 0.8125rem;
    color: var(--text-main);
    line-height: 1.5;
    border-left: 3px solid var(--primary);
  }

  .dialog-placeholder {
    text-align: center;
    padding: 2rem;
    color: var(--text-muted);
    font-style: italic;
  }

  /* -- No results -- */
  .no-results {
    text-align: center;
    padding: 3rem 1rem;
    color: var(--text-muted);
  }

  .no-results .material-symbols-outlined {
    font-size: 48px;
    margin-bottom: 0.75rem;
    opacity: 0.5;
  }

  .no-results p { font-size: 1rem; }
}

/* ---------- LOADING BAR ---------- */
@layer components {
  .loading-bar {
    padding: 3rem 1rem;
    text-align: center;
  }

  .loading-bar-text {
    font-family: var(--font-display);
    font-size: 1.1rem;
    color: var(--text-muted);
    margin-bottom: 1rem;
    letter-spacing: 0.02em;
  }

  .loading-bar-track {
    width: 100%;
    max-width: 400px;
    height: 6px;
    background: var(--border);
    border-radius: 3px;
    margin: 0 auto;
    overflow: hidden;
  }

  .loading-bar-fill {
    height: 100%;
    width: 0%;
    background: var(--primary);
    border-radius: 3px;
    transition: width 0.3s ease;
  }

  .loading-bar-status {
    margin-top: 0.75rem;
    font-size: 0.8rem;
    color: var(--text-muted);
    font-family: monospace;
  }
}

/* ---------- UTILITIES ---------- */
@layer utilities {
  .is-hidden {
    display: none !important;
  }

  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }
}
</style>
</head>
<body>

<!-- ============================================================
     HEADER
     ============================================================ -->
<header class="site-header">
  <div class="header-inner">
    <!-- Logo -->
    <div class="logo-area">
      <div class="logo-icon">
        <span class="material-symbols-outlined" style="font-size:22px">terminal</span>
      </div>
      <span class="logo-text">enhanceclaude.com</span>
      <span class="logo-separator"></span>
      <span class="logo-tagline">super charge your ai coding with advanced tools</span>
    </div>

    <!-- Search -->
    <div class="search-wrapper">
      <div class="search-field">
        <span class="material-symbols-outlined">search</span>
        <input
          type="text"
          id="search-input"
          placeholder="Search skills, agents..."
          autocomplete="off"
          spellcheck="false"
        />
      </div>
    </div>

    <!-- Actions -->
    <div class="header-actions">
      <a href="mailto:info@enhanceclaude.com" title="Contact">
        <span class="material-symbols-outlined" style="font-size:20px">mail</span>
      </a>
      <a href="https://github.com/RandyHaylor/enhanceclaude" title="View on GitHub" target="_blank" rel="noopener noreferrer">
        <span class="material-symbols-outlined" style="font-size:20px">code</span>
      </a>
    </div>
  </div>
</header>

<!-- ============================================================
     PAGE LAYOUT
     ============================================================ -->
<div class="page-layout">

  <!-- SIDEBAR (desktop) -->
  <aside class="sidebar">
    <div class="sidebar-sticky">
      <div class="sidebar-showing" id="showing-count">Showing 0 resources</div>
      <h3 class="sidebar-heading">Browse Library</h3>
      <nav>
        <ul class="sidebar-nav" id="sidebar-nav">
          <li>
            <button class="sidebar-nav-btn is-active" data-filter="all">
              <span class="material-symbols-outlined">grid_view</span>
              All Resources
              <span class="sidebar-count" id="count-all">0</span>
            </button>
          </li>
          <li>
            <button class="sidebar-nav-btn" data-filter="agent">
              <span class="material-symbols-outlined">smart_toy</span>
              Agents
              <span class="sidebar-count" id="count-agent">0</span>
            </button>
          </li>
          <li>
            <button class="sidebar-nav-btn" data-filter="skill">
              <span class="material-symbols-outlined">psychology</span>
              Skills
              <span class="sidebar-count" id="count-skill">0</span>
            </button>
          </li>
        </ul>
      </nav>
      <h3 class="sidebar-heading" style="margin-top:1.5rem">Filter by Tag</h3>
      <div class="tag-filter-panel" id="tag-filter-panel">
        <!-- Populated by JS -->
      </div>
      <button class="tag-clear-btn is-hidden" id="tag-clear-btn">
        <span class="material-symbols-outlined" style="font-size:14px">close</span>
        Clear tags
      </button>
    </div>
  </aside>

  <!-- MOBILE FILTERS -->
  <div class="mobile-filters" id="mobile-filters">
    <div class="mobile-filters-row">
      <button class="mobile-filter-btn is-active" data-filter="all">All</button>
      <button class="mobile-filter-btn" data-filter="agent">Agents</button>
      <button class="mobile-filter-btn" data-filter="skill">Skills</button>
      <button class="mobile-filter-btn mobile-tag-toggle" id="mobile-tag-toggle">
        <span class="material-symbols-outlined" style="font-size:16px;vertical-align:middle">label</span>
        Tags
      </button>
    </div>
    <div class="mobile-tag-panel is-hidden" id="mobile-tag-menu">
      <!-- Populated by JS -->
    </div>
  </div>

  <!-- MAIN CONTENT -->
  <main class="main-content">
    <!-- Loading Bar -->
    <div class="loading-bar" id="loading-bar">
      <div class="loading-bar-text">gathering ai tools...</div>
      <div class="loading-bar-track">
        <div class="loading-bar-fill" id="loading-bar-fill"></div>
      </div>
      <div class="loading-bar-status" id="loading-bar-status"></div>
    </div>

    <!-- Cards Container -->
    <div class="cards-container is-hidden" id="cards-container">
      <!-- Cards rendered by JS -->
    </div>

    <!-- No Results -->
    <div class="no-results is-hidden" id="no-results">
      <span class="material-symbols-outlined">search_off</span>
      <p>No resources match your search.</p>
    </div>
  </main>
</div>

<!-- ============================================================
     FOOTER
     ============================================================ -->
<footer class="site-footer">
  <div class="footer-inner">
    <div class="footer-contact">
      <span class="material-symbols-outlined" style="font-size:18px;color:var(--primary)">mail</span>
      <span>To inquire about this site or find out about consulting services, contact <a href="mailto:info@enhanceclaude.com" class="footer-email">info@enhanceclaude.com</a></span>
    </div>
    <span class="footer-brand">enhanceclaude.com</span>
    <p class="footer-disclaimer">
      enhanceclaude.com is an independent resource. Claude&trade; is a trademark of Anthropic, PBC.
      This site is not affiliated with or endorsed by Anthropic.
    </p>
  </div>
</footer>

<!-- ============================================================
     INSTALL DIALOG
     ============================================================ -->
<dialog class="install-dialog" id="install-dialog">
  <div class="dialog-header">
    <span class="dialog-title" id="dialog-title">Install</span>
    <button class="dialog-close-btn" id="dialog-close-btn" aria-label="Close">
      <span class="material-symbols-outlined">close</span>
    </button>
  </div>
  <div class="dialog-body" id="dialog-body">
    <!-- Populated by JS -->
  </div>
</dialog>

<!-- ============================================================
     JAVASCRIPT
     ============================================================ -->
<script>
/* ============================================================
   Section 1: Config
   ============================================================ */
const GITHUB_OWNER = 'RandyHaylor';
const GITHUB_REPO = 'enhanceclaude';
const GITHUB_BRANCH = 'main';
const TOOLS_DIR = 'ai-tools';
const SITE_BASE_URL = 'https://enhanceclaude.com';
const GITHUB_API_URL = `https://api.github.com/repos/${GITHUB_OWNER}/${GITHUB_REPO}/contents/${TOOLS_DIR}`;
const GITHUB_RAW_URL = `https://raw.githubusercontent.com/${GITHUB_OWNER}/${GITHUB_REPO}/${GITHUB_BRANCH}`;
const INSTALL_INSTRUCTIONS_PATH = `${GITHUB_RAW_URL}/site-html/installation-instructions.json`;

/* ============================================================
   Section 2: Data Loader — fetches live from GitHub
   ============================================================ */

/** Update the loading bar progress and status text */
function updateLoadingBar(percent, statusText) {
  const fill = document.getElementById('loading-bar-fill');
  const status = document.getElementById('loading-bar-status');
  if (fill) fill.style.width = percent + '%';
  if (status) status.textContent = statusText;
}

/** List subfolders in ai-tools/ via GitHub Contents API */
async function fetchToolFolderList() {
  const resp = await fetch(GITHUB_API_URL);
  if (!resp.ok) throw new Error(`GitHub API returned ${resp.status}`);
  const items = await resp.json();
  return items.filter(item => item.type === 'dir').map(item => item.name);
}

/** Fetch a single tool-info.json from raw.githubusercontent.com */
async function fetchToolInfo(folderName) {
  const url = `${GITHUB_RAW_URL}/${TOOLS_DIR}/${folderName}/tool-info.json`;
  const resp = await fetch(url);
  if (!resp.ok) return null;
  const data = await resp.json();
  data.folder = folderName;
  return data;
}

/** Fetch all tools: list folders, then fetch each tool-info.json */
async function fetchAllToolsFromGitHub() {
  updateLoadingBar(5, 'contacting github...');

  const folders = await fetchToolFolderList();
  updateLoadingBar(15, `found ${folders.length} tool folders`);

  const tools = [];
  for (let i = 0; i < folders.length; i++) {
    const folderName = folders[i];
    updateLoadingBar(
      15 + Math.round((i / folders.length) * 80),
      `fetching ${folderName}...`
    );
    const toolData = await fetchToolInfo(folderName);
    if (toolData) tools.push(toolData);
  }

  updateLoadingBar(100, `loaded ${tools.length} tools`);
  return tools;
}

/** Fetch installation instructions; gracefully returns null if missing */
async function fetchInstallInstructions() {
  try {
    const resp = await fetch(INSTALL_INSTRUCTIONS_PATH);
    if (!resp.ok) return null;
    return await resp.json();
  } catch {
    return null;
  }
}

/* ============================================================
   Section 3: Card Renderer
   ============================================================ */

/**
 * Escape HTML entities to prevent XSS when inserting user-facing data.
 */
function esc(str) {
  if (!str) return '';
  const div = document.createElement('div');
  div.textContent = str;
  return div.innerHTML;
}

/**
 * Render a single tool card as an HTML string.
 */
function renderToolCard(tool) {
  const isAgent = tool.type === 'agent';
  const iconName = isAgent ? 'smart_toy' : 'psychology';
  const iconClass = isAgent ? 'card-icon--agent' : 'card-icon--skill';
  const typeLabelClass = isAgent ? 'card-type-label--agent' : 'card-type-label--skill';
  const typeLabel = isAgent ? 'Agent' : 'Skill';

  // OS badges
  const osBadges = (tool.os || []).map(os =>
    `<span class="os-badge">${esc(os)}</span>`
  ).join('');

  // Tag badges
  const tags = (tool.tags || []).map(tag =>
    `<span class="tag-badge">${esc(tag)}</span>`
  ).join('');

  // Custom instructions note
  const customNote = tool.customInstructions
    ? `<div class="card-custom-note">
         <span class="material-symbols-outlined">info</span>
         <span>${esc(tool.customInstructions)}</span>
       </div>`
    : '';

  return `<article class="tool-card" data-type="${esc(tool.type)}" data-name="${esc(tool.name)}" data-folder="${esc(tool.folder)}" data-tags="${esc((tool.tags || []).join(' '))}">
    <div class="card-inner">
      <div class="card-top">
        <div class="card-top-left">
          <div class="card-icon ${iconClass}">
            <span class="material-symbols-outlined">${iconName}</span>
          </div>
          <div>
            <div class="card-name-row">
              <h3 class="card-name">${esc(tool.name)}</h3>
              <span class="card-version">${esc(tool.version || '')}</span>
            </div>
            <div class="card-meta">
              <span class="card-type-label ${typeLabelClass}">
                <span class="material-symbols-outlined">${iconName}</span>
                ${typeLabel}
              </span>
              <span class="meta-dot"></span>
              <span class="os-badges">${osBadges}</span>
              ${tool.author ? `<span class="meta-dot"></span><span>${esc(tool.author)}</span>` : ''}
            </div>
          </div>
        </div>
        <div class="card-actions">
          <button class="card-action-btn card-share-btn" data-folder="${esc(tool.folder)}" title="Share via link">
            <span class="material-symbols-outlined">share</span>
          </button>
          <button class="card-action-btn card-install-btn" data-folder="${esc(tool.folder)}">
            <span class="material-symbols-outlined">download</span>
            Install
          </button>
          <button class="card-action-btn card-expand-btn" data-folder="${esc(tool.folder)}" title="More details">
            <span class="material-symbols-outlined">expand_more</span>
          </button>
        </div>
      </div>
      <div class="card-description">${esc(tool.description)}</div>
      <div class="card-footer-row">
        <div class="card-tags">${tags}</div>
      </div>
      ${customNote}
    </div>
  </article>`;
}

/**
 * Render all cards into the container.
 */
function renderAllCards(tools) {
  const container = document.getElementById('cards-container');
  container.innerHTML = tools.map(renderToolCard).join('');
}

/* ============================================================
   Section 4: Filter Controller
   ============================================================ */

let currentTypeFilter = 'all';
let currentSearchQuery = '';
let activeTags = new Set();
let allTools = [];

/** Apply type filter, search filter, and tag filter together */
function filterCards() {
  const container = document.getElementById('cards-container');
  const cards = container.querySelectorAll('.tool-card');
  const query = currentSearchQuery.toLowerCase().trim();
  let visibleCount = 0;

  cards.forEach(card => {
    const type = card.getAttribute('data-type');
    const name = card.getAttribute('data-name').toLowerCase();
    const tags = card.getAttribute('data-tags').toLowerCase();
    const desc = card.querySelector('.card-description')?.textContent.toLowerCase() || '';

    const matchesType = (currentTypeFilter === 'all') || (type === currentTypeFilter);
    const matchesSearch = !query || name.includes(query) || tags.includes(query) || desc.includes(query);
    const matchesTags = activeTags.size === 0 || [...activeTags].every(t => tags.includes(t.toLowerCase()));

    if (matchesType && matchesSearch && matchesTags) {
      card.classList.remove('is-hidden');
      visibleCount++;
    } else {
      card.classList.add('is-hidden');
    }
  });

  document.getElementById('showing-count').textContent = `Showing ${visibleCount} resource${visibleCount !== 1 ? 's' : ''}`;
  document.getElementById('no-results').classList.toggle('is-hidden', visibleCount > 0);

  // Show/hide clear tags button
  const clearBtn = document.getElementById('tag-clear-btn');
  if (clearBtn) clearBtn.classList.toggle('is-hidden', activeTags.size === 0);

  // Update mobile tag toggle appearance
  const mobileToggle = document.getElementById('mobile-tag-toggle');
  if (mobileToggle) mobileToggle.classList.toggle('has-active', activeTags.size > 0);
}

/** Update sidebar counts based on loaded data */
function updateCounts() {
  const total = allTools.length;
  const agents = allTools.filter(t => t.type === 'agent').length;
  const skills = allTools.filter(t => t.type === 'skill').length;

  document.getElementById('count-all').textContent = total;
  document.getElementById('count-agent').textContent = agents;
  document.getElementById('count-skill').textContent = skills;
}

/** Build tag filter chips from loaded tools */
function buildTagFilters() {
  const tagSet = new Set();
  allTools.forEach(t => (t.tags || []).forEach(tag => tagSet.add(tag)));
  const sortedTags = [...tagSet].sort();

  // Desktop sidebar panel
  const panel = document.getElementById('tag-filter-panel');
  panel.innerHTML = sortedTags.map(tag =>
    `<button class="tag-filter-chip" data-tag="${esc(tag)}">${esc(tag)}</button>`
  ).join('');

  // Mobile dropdown
  const mobileMenu = document.getElementById('mobile-tag-menu');
  if (mobileMenu) {
    mobileMenu.innerHTML = sortedTags.map(tag =>
      `<button class="tag-filter-chip" data-tag="${esc(tag)}">${esc(tag)}</button>`
    ).join('');
  }
}

/** Toggle a tag in the active set and sync all chip states */
function toggleTag(tag) {
  if (activeTags.has(tag)) {
    activeTags.delete(tag);
  } else {
    activeTags.add(tag);
  }
  syncTagChips();
  filterCards();
}

/** Sync all tag chip active states across desktop and mobile */
function syncTagChips() {
  document.querySelectorAll('.tag-filter-chip').forEach(chip => {
    chip.classList.toggle('is-active', activeTags.has(chip.dataset.tag));
  });
}

/** Wire sidebar filter buttons */
function wireFilters() {
  // Desktop sidebar type buttons
  const sidebarBtns = document.querySelectorAll('#sidebar-nav .sidebar-nav-btn');
  sidebarBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      sidebarBtns.forEach(b => b.classList.remove('is-active'));
      btn.classList.add('is-active');
      currentTypeFilter = btn.getAttribute('data-filter');
      syncMobileFilters();
      filterCards();
    });
  });

  // Mobile type pill buttons (exclude tag toggle)
  const mobileBtns = document.querySelectorAll('#mobile-filters .mobile-filter-btn:not(.mobile-tag-toggle)');
  mobileBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('#mobile-filters .mobile-filter-btn:not(.mobile-tag-toggle)').forEach(b => b.classList.remove('is-active'));
      btn.classList.add('is-active');
      currentTypeFilter = btn.getAttribute('data-filter');
      syncDesktopFilters();
      filterCards();
    });
  });

  // Search input
  const searchInput = document.getElementById('search-input');
  searchInput.addEventListener('input', () => {
    currentSearchQuery = searchInput.value;
    filterCards();
  });

  // Tag chip clicks (delegated on both panels)
  document.getElementById('tag-filter-panel').addEventListener('click', (e) => {
    const chip = e.target.closest('.tag-filter-chip');
    if (chip) toggleTag(chip.dataset.tag);
  });

  const mobileMenu = document.getElementById('mobile-tag-menu');
  if (mobileMenu) {
    mobileMenu.addEventListener('click', (e) => {
      const chip = e.target.closest('.tag-filter-chip');
      if (chip) toggleTag(chip.dataset.tag);
    });
  }

  // Clear tags button
  document.getElementById('tag-clear-btn').addEventListener('click', () => {
    activeTags.clear();
    syncTagChips();
    filterCards();
  });

  // Mobile tag dropdown toggle
  const mobileToggle = document.getElementById('mobile-tag-toggle');
  if (mobileToggle) {
    mobileToggle.addEventListener('click', (e) => {
      e.stopPropagation();
      const menu = document.getElementById('mobile-tag-menu');
      menu.classList.toggle('is-hidden');
    });
    // Close dropdown when clicking outside
    document.addEventListener('click', () => {
      const menu = document.getElementById('mobile-tag-menu');
      if (menu && !menu.classList.contains('is-hidden')) {
        menu.classList.add('is-hidden');
      }
    });
    if (mobileMenu) {
      mobileMenu.addEventListener('click', (e) => e.stopPropagation());
    }
  }
}

function syncMobileFilters() {
  document.querySelectorAll('#mobile-filters .mobile-filter-btn:not(.mobile-tag-toggle)').forEach(btn => {
    btn.classList.toggle('is-active', btn.getAttribute('data-filter') === currentTypeFilter);
  });
}

function syncDesktopFilters() {
  document.querySelectorAll('#sidebar-nav .sidebar-nav-btn').forEach(btn => {
    btn.classList.toggle('is-active', btn.getAttribute('data-filter') === currentTypeFilter);
  });
}

/* ============================================================
   Section 5: Tool Detail Expansion
   ============================================================ */

/** Convert basic markdown to HTML */
function simpleMarkdownToHtml(md) {
  /** Apply inline formatting to a line */
  function inlineFmt(line) {
    let html = esc(line);
    html = html.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
    html = html.replace(/\*(.+?)\*/g, '<em>$1</em>');
    html = html.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank" rel="noopener">$1</a>');
    html = html.replace(/`([^`]+)`/g, '<code>$1</code>');
    return html;
  }

  const lines = md.split('\n');
  const out = [];
  let i = 0;

  while (i < lines.length) {
    const line = lines[i].trimEnd();

    // Skip blank lines
    if (!line.trim()) { i++; continue; }

    // Headings
    if (line.startsWith('### ')) { out.push(`<h2>${inlineFmt(line.slice(4))}</h2>`); i++; continue; }
    if (line.startsWith('## ')) { out.push(`<h2>${inlineFmt(line.slice(3))}</h2>`); i++; continue; }
    if (line.startsWith('# ')) { out.push(`<h1>${inlineFmt(line.slice(2))}</h1>`); i++; continue; }

    // Horizontal rule
    if (/^---+$/.test(line.trim())) { out.push('<hr/>'); i++; continue; }

    // Bullet list
    if (/^[\-\*]\s/.test(line.trim())) {
      let items = [];
      while (i < lines.length && /^[\-\*]\s/.test(lines[i].trim())) {
        items.push(`<li>${inlineFmt(lines[i].trim().slice(2))}</li>`);
        i++;
      }
      out.push(`<ul>${items.join('')}</ul>`);
      continue;
    }

    // Numbered list
    if (/^\d+\.\s/.test(line.trim())) {
      let items = [];
      while (i < lines.length && /^\d+\.\s/.test(lines[i].trim())) {
        items.push(`<li>${inlineFmt(lines[i].trim().replace(/^\d+\.\s/, ''))}</li>`);
        i++;
      }
      out.push(`<ol>${items.join('')}</ol>`);
      continue;
    }

    // Paragraph (collect consecutive non-blank, non-special lines)
    let para = [];
    while (i < lines.length && lines[i].trim() && !/^[#\-\*]/.test(lines[i].trim()) && !/^\d+\.\s/.test(lines[i].trim()) && !/^---+$/.test(lines[i].trim())) {
      para.push(inlineFmt(lines[i].trim()));
      i++;
    }
    if (para.length) out.push(`<p>${para.join(' ')}</p>`);
  }

  return out.join('\n');
}

/** Fetch the readme.md for a tool from GitHub raw */
async function fetchToolReadme(folder, readmeFile) {
  const url = `${GITHUB_RAW_URL}/${TOOLS_DIR}/${folder}/${readmeFile || 'readme.md'}`;
  try {
    const resp = await fetch(url);
    if (!resp.ok) return null;
    return await resp.text();
  } catch {
    return null;
  }
}

/** Collapse any currently expanded tool card */
function collapseExpandedCard() {
  const expanded = document.querySelector('.tool-card.is-expanded');
  if (expanded) {
    expanded.classList.remove('is-expanded');
    const panel = expanded.querySelector('.tool-detail-panel');
    if (panel) panel.remove();
  }
  // Clear URL param
  if (window.history.replaceState) {
    const url = new URL(window.location);
    url.searchParams.delete('toolName');
    window.history.replaceState({}, '', url);
  }
}

/** Expand a tool card to show the detail panel */
async function expandToolCard(folder) {
  const tool = allTools.find(t => t.folder === folder);
  if (!tool) return;

  // Collapse any existing expanded card
  collapseExpandedCard();

  const cardEl = document.querySelector(`.tool-card[data-folder="${folder}"]`);
  if (!cardEl) return;

  cardEl.classList.add('is-expanded');

  // Build the detail panel
  const panel = document.createElement('div');
  panel.className = 'tool-detail-panel';
  panel.innerHTML = `
    <div class="detail-header">
      <span class="detail-title">Loading...</span>
      <button class="detail-close-btn" title="Close">
        <span class="material-symbols-outlined">close</span>
      </button>
    </div>
    <div class="detail-readme"></div>
  `;

  cardEl.querySelector('.card-inner').appendChild(panel);

  // Wire close button
  panel.querySelector('.detail-close-btn').addEventListener('click', (e) => {
    e.stopPropagation();
    collapseExpandedCard();
  });

  // Update URL
  if (window.history.replaceState) {
    const url = new URL(window.location);
    url.searchParams.set('toolName', folder);
    window.history.replaceState({}, '', url);
  }

  // Scroll into view
  cardEl.scrollIntoView({ behavior: 'smooth', block: 'nearest' });

  // Fetch and render readme
  const readmeText = await fetchToolReadme(folder, tool.readme);
  const readmeContainer = panel.querySelector('.detail-readme');

  if (readmeText) {
    readmeContainer.innerHTML = simpleMarkdownToHtml(readmeText);
  } else {
    readmeContainer.innerHTML = `<p style="color:var(--text-muted)">No readme available.</p>`;
  }

  // Update header text
  panel.querySelector('.detail-title').textContent = tool.name;
}

/** Wire card click to expand (but not on install/share button clicks) */
function wireCardExpansion() {
  document.getElementById('cards-container').addEventListener('click', (e) => {
    // Handle share button
    const shareBtn = e.target.closest('.card-share-btn');
    if (shareBtn) {
      e.stopPropagation();
      const folder = shareBtn.dataset.folder;
      const shareUrl = `${SITE_BASE_URL}?toolName=${encodeURIComponent(folder)}`;
      navigator.clipboard.writeText(shareUrl).then(() => {
        shareBtn.classList.add('is-copied');
        const icon = shareBtn.querySelector('.material-symbols-outlined');
        if (icon) icon.textContent = 'check';
        setTimeout(() => {
          shareBtn.classList.remove('is-copied');
          if (icon) icon.textContent = 'share';
        }, 1500);
      });
      return;
    }

    // Handle expand caret button
    const expandBtn = e.target.closest('.card-expand-btn');
    if (expandBtn) {
      e.stopPropagation();
      const card = expandBtn.closest('.tool-card');
      if (!card) return;
      if (card.classList.contains('is-expanded')) {
        collapseExpandedCard();
      } else {
        expandToolCard(card.dataset.folder);
      }
      return;
    }

  });
}

/** Check URL params and auto-expand if ?toolName=xxx is present */
function handleUrlToolParam() {
  const params = new URLSearchParams(window.location.search);
  const toolName = params.get('toolName');
  if (toolName) {
    expandToolCard(toolName);
  }
}

/* ============================================================
   Section 6: Install Overlay
   ============================================================ */

let installInstructions = null;

/**
 * Find matching installation entries for a given tool type from the
 * installation-instructions.json data.
 */
function getInstallEntriesForType(type) {
  if (!installInstructions || !Array.isArray(installInstructions)) return [];
  const entries = [];
  for (const platform of installInstructions) {
    const matching = (platform.installations || []).filter(inst => inst.type === type);
    if (matching.length > 0) {
      entries.push({ platform: platform.platform, installations: matching });
    }
  }
  return entries;
}

/**
 * Populate and show the install dialog for a given tool.
 */
/** Copy text to clipboard and flash the button green */
function copyToClipboard(text, btnEl) {
  navigator.clipboard.writeText(text).then(() => {
    btnEl.classList.add('copy-btn--copied');
    const icon = btnEl.querySelector('.material-symbols-outlined');
    if (icon) icon.textContent = 'check';
    setTimeout(() => {
      btnEl.classList.remove('copy-btn--copied');
      if (icon) icon.textContent = 'content_copy';
    }, 1500);
  });
}

function showInstallDialog(tool) {
  const dialog = document.getElementById('install-dialog');
  const titleEl = document.getElementById('dialog-title');
  const bodyEl = document.getElementById('dialog-body');

  titleEl.textContent = `Install: ${tool.name}`;

  const folderName = tool.folder || 'my-tool';
  const cloneCmd = `git clone --depth 1 https://github.com/${GITHUB_OWNER}/${GITHUB_REPO}.git && cp -r ${GITHUB_REPO}/${TOOLS_DIR}/${folderName} ./ && rm -rf ${GITHUB_REPO}`;

  let html = '';

  // Clone commands at top
  html += `<div class="dialog-section">
    <div class="dialog-section-label">Download Command <span style="font-weight:400;text-transform:none;letter-spacing:0">— see below for correct location</span></div>
    <div class="dialog-clone-block">
      <div class="dialog-clone-row">
        <code>${esc(cloneCmd)}</code>
        <button class="copy-btn" onclick="copyToClipboard(this.previousElementSibling.textContent, this)" title="Copy">
          <span class="material-symbols-outlined">content_copy</span>
        </button>
      </div>
    </div>
  </div>`;

  // Meta info
  html += `<div class="dialog-section">
    <div class="dialog-section-label">Details</div>
    <div class="dialog-meta-row">
      <span class="dialog-meta-item">
        <span class="material-symbols-outlined">${tool.type === 'agent' ? 'smart_toy' : 'psychology'}</span>
        ${esc(tool.type === 'agent' ? 'Agent' : 'Skill')}
      </span>
      <span class="dialog-meta-item">
        <span class="material-symbols-outlined">tag</span>
        ${esc(tool.version || 'n/a')}
      </span>
      <span class="dialog-meta-item">
        <span class="material-symbols-outlined">computer</span>
        ${esc((tool.os || []).join(', '))}
      </span>
    </div>
  </div>`;

  // Installation instructions by platform
  const platformEntries = getInstallEntriesForType(tool.type);

  if (platformEntries.length > 0) {
    html += `<div class="dialog-section">
      <div class="dialog-section-label">Installation by Platform</div>`;

    for (const entry of platformEntries) {
      html += `<div class="dialog-platform-block">
        <div class="dialog-platform-name">${esc(entry.platform)}</div>`;

      for (const inst of entry.installations) {
        html += `<div class="dialog-install-entry">`;

        const scopeLabel = inst.scope ? ` (${inst.scope})` : '';
        html += `<div class="dialog-install-type">${esc(inst.type)}${esc(scopeLabel)}</div>`;

        if (inst.path) {
          // Replace <skill-name> or <name> with the tool folder name
          const resolvedPath = inst.path
            .replace(/<skill-name>/g, tool.folder || 'my-tool')
            .replace(/<name>/g, tool.folder || 'my-tool');
          html += `<code class="dialog-install-path">${esc(resolvedPath)}</code>`;
        }

        if (inst.windowsPath) {
          const resolvedWin = inst.windowsPath
            .replace(/<skill-name>/g, tool.folder || 'my-tool')
            .replace(/<name>/g, tool.folder || 'my-tool')
            .replace(/<username>/g, '&lt;username&gt;');
          html += `<code class="dialog-install-path dialog-install-path--windows">Windows: ${esc(resolvedWin)}</code>`;
        }

        html += `</div>`;
      }

      html += `</div>`;
    }

    html += `</div>`;
  } else {
    html += `<div class="dialog-section">
      <div class="dialog-placeholder">Installation instructions coming soon.</div>
    </div>`;
  }

  // Custom instructions
  if (tool.customInstructions) {
    html += `<div class="dialog-section">
      <div class="dialog-section-label">Requirements / Notes</div>
      <div class="dialog-custom-instructions">${esc(tool.customInstructions)}</div>
    </div>`;
  }

  bodyEl.innerHTML = html;

  // Align dialog with the main content / cards area
  const cardsEl = document.getElementById('cards-container');
  if (cardsEl) {
    const rect = cardsEl.getBoundingClientRect();
    dialog.style.left = rect.left + 'px';
    dialog.style.width = rect.width + 'px';
  }

  dialog.showModal();
}

/** Wire install dialog events */
function wireInstallDialog() {
  const dialog = document.getElementById('install-dialog');
  const closeBtn = document.getElementById('dialog-close-btn');

  // Close button
  closeBtn.addEventListener('click', () => dialog.close());

  // Click outside to close (click on backdrop)
  dialog.addEventListener('click', (e) => {
    if (e.target === dialog) dialog.close();
  });

  // Delegate install button clicks from cards
  document.getElementById('cards-container').addEventListener('click', (e) => {
    const btn = e.target.closest('.card-install-btn');
    if (!btn) return;
    const folder = btn.getAttribute('data-folder');
    const tool = allTools.find(t => t.folder === folder);
    if (tool) showInstallDialog(tool);
  });
}

/* ============================================================
   Section 7: Init
   ============================================================ */

document.addEventListener('DOMContentLoaded', async () => {
  const loadingBar = document.getElementById('loading-bar');
  const cardsContainer = document.getElementById('cards-container');

  try {
    // Fetch tools from GitHub live, install instructions in parallel
    const [tools, instructions] = await Promise.all([
      fetchAllToolsFromGitHub(),
      fetchInstallInstructions()
    ]);

    allTools = tools;
    installInstructions = instructions;

    // Hide loading bar, show cards
    loadingBar.classList.add('is-hidden');
    cardsContainer.classList.remove('is-hidden');

    // Render
    renderAllCards(allTools);
    updateCounts();
    buildTagFilters();
    filterCards();

    // Wire interactions
    wireFilters();
    wireInstallDialog();
    wireCardExpansion();

    // Auto-expand if ?toolName=xxx is in the URL
    handleUrlToolParam();
  } catch (err) {
    console.error('Failed to load tools from GitHub:', err);
    updateLoadingBar(0, 'failed to load tools — check console');
  }
});
</script>

</body>
</html>
